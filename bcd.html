        <th style="width:10%">Suppr</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="cachet">
    <img id="cachetImage" src="images/cachet_kamel.png" alt="Cachet et signature">
  </div>

  <div class="btns">
    <button onclick="addRow()">‚ûï Ajouter ligne</button>
    <button onclick="enregistrerPDF()">üìÑ Enregistrer PDF</button>
  </div>

</div>

<script>
  // --- Fournisseurs ---
  function changerFournisseur() {
    const select = document.getElementById("clientSelect").value;
    const infoDiv = document.getElementById("infoFournisseur");
    const cachetImg = document.getElementById("cachetImage");

    if (select === "abdellah") {
      infoDiv.innerHTML = `
        <strong>TABBOU ABDELLAH</strong><br>
        zone d√©p√¥t hamrouche hammoudi skikda<br>
        N¬∞ Register : 02A0727885<br>
        ID Fiscal : 1965521210024739<br>
        N¬∞ Article Imp√¥t : 21379976405
      `;
      cachetImg.src = "images/cachet_abdellah.png";
    } else {
      infoDiv.innerHTML = `
        <strong>TABBOU KAMEL</strong><br>
        cit√© tafrala lot n¬∞01 beni oulbene skikda<br>
        N¬∞ Register : 12 A 0758272<br>
        ID Fiscal : 184210105292140<br>
        N¬∞ Article Imp√¥t : 21210460081
      `;
      cachetImg.src = "images/cachet_kamel.png";
    }
  }

  // --- Produits disponibles ---
  const produits = [
    { code: "B9805Y0077", nom: "ELIO II 1 L 900" },
    { code: "B9805Y0079", nom: "ELIO II RONDE 2 L" },
    { code: "B9805Y0078", nom: "ELIO II 5 L" }
  ];

  // --- Ajout ligne ---
  function addRow() {
    const tbody = document.querySelector("#table tbody");
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input list="codes" class="code" placeholder="Code produit" oninput="updateFromCode(this)"></td>
      <td><input list="noms" class="designation" placeholder="D√©signation" oninput="updateFromName(this)"></td>
      <td><input type="number" placeholder="Qt√©" min="0"></td>
      <td>
        <select>
          <option value="Palette">Palette</option>
          <option value="Colis">Colis</option>
          <option value="Unit√©">Unit√©</option>
        </select>
      </td>
      <td><button onclick="removeRow(this)">‚úñ</button></td>
    `;
    tbody.appendChild(row);
  }

  function updateFromCode(input) {
    const row = input.closest("tr");
    const produit = produits.find(p => p.code.toLowerCase() === input.value.toLowerCase());
    if (produit) row.querySelector(".designation").value = produit.nom;
  }

  function updateFromName(input) {
    const row = input.closest("tr");
    const produit = produits.find(p => p.nom.toLowerCase() === input.value.toLowerCase());
    if (produit) row.querySelector(".code").value = produit.code;
  }

  function removeRow(btn) { btn.closest("tr").remove(); }

  document.body.insertAdjacentHTML("beforeend", `
    <datalist id="codes">${produits.map(p => `<option value="${p.code}">`).join("")}</datalist>
    <datalist id="noms">${produits.map(p => `<option value="${p.nom}">`).join("")}</datalist>
  `);

  // --- Date d'aujourd'hui ---
  const dateField = document.getElementById("dateBC");
  const today = new Date().toLocaleDateString("fr-FR");
  dateField.value = today;

  // --- G√©n√©ration du PDF ---
  async function enregistrerPDF() {
    const bouton = document.querySelector(".btns button:last-child");
    bouton.textContent = "‚è≥ Cr√©ation du PDF...";
    bouton.disabled = true;

    const element = document.getElementById("bonCommande");
    const canvas = await html2canvas(element, { scale: 2, useCORS: true });
    const imgData = canvas.toDataURL("image/png");

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "pt", "a4");
    const pageWidth = 595.28;
    const imgHeight = (canvas.height * pageWidth) / canvas.width;

    pdf.addImage(imgData, "PNG", 0, 0, pageWidth, imgHeight);

    const numBC = document.getElementById("numBC").value.replace(/\//g, "_");
    const dateStr = today.replace(/\//g, "-");
    pdf.save(`Bon_Commande_${numBC}_${dateStr}.pdf`);

    bouton.textContent = "üìÑ Enregistrer PDF";
    bouton.disabled = false;
  }

  window.onload = addRow;
</script>

</body>
</html>
