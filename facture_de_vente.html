<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #f3f4f6;
      color: #000;
    }

    .invoice-page {
      width: 210mm;
      min-height: 297mm;
      background: #fff;
      margin: 15mm auto;
      padding: 15mm;
      border: 1px solid #000;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    .company-header {
      text-align: center;
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }

    .company-header h1 {
      font-size: 26px;
      font-weight: 800;
      text-decoration: underline;
    }

    .company-header p {
      font-size: 13px;
      margin: 2px 0;
    }

    .invoice-header {
      text-align: center;
      font-weight: 700;
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
      padding: 4px;
      display: inline-block;
      margin: 10px 0;
    }

    .section-box {
      border: 1px solid #000;
      padding: 6px 10px;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .section-box2 {
      padding: 0px 0px;
      font-size: 12px;
      margin-bottom: 10px;
    }

    .section-title {
      font-weight: bold;
      font-size: 13px;
      border-bottom: 1px solid #000;
      margin-bottom: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-top: 4px;
    }

    th, td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
    }

    th {
      background: #f9f9f9;
      font-weight: bold;
    }

    .totals-box {
      width: 60%;
      float: left;
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 13px;
      border: 1px solid #000;
      border-radius: 4px;
      padding: 10px;
      background: #fff;
    }

    .totals-table {
      width: 100%;
      border-collapse: collapse;
      direction: rtl;
    }

    .totals-table td {
      padding: 4px 8px;
      border: none;
    }

    .totals-table .amount {
      text-align: left;
      font-weight: 600;
    }

    .totals-table .label {
      text-align: right;
      font-weight: 500;
    }

    .totals-table .total .label,
    .totals-table .total .amount {
      font-weight: 700;
      border-top: 1px solid #000;
      padding-top: 5px;
    }

    .amount-words {
      clear: both;
      border-top: 1px dashed #000;
      padding-top: 6px;
      font-size: 12px;
      margin-top: 15px;
      margin-bottom: 15px;
    }

    .signature {
      margin-top: 50px;
      font-size: 12px;
      text-align: center;
      display: flex;
      justify-content: flex-end;
    }

    .sig-box { width: 40%; }
    .sig-line { border-top: 1px solid #000; margin-top: 25px; }

    @media print {
      body { background: #fff; margin: 0; font-size: 12px; }
      .invoice-page {
        width: 200mm !important;
        min-height: 287mm !important;
        margin: 0 auto !important;
        padding: 5mm !important;
        border: 0 !important;
        box-shadow: none !important;
      }
      .no-print { display: none !important; }
      @page { size: A4; margin: 2mm; }
    }
  </style>
</head>

<body>
  <div class="invoice-page" id="invoice">
    <div class="company-header">
      <h1>Ø·Ù€Ù€Ù€Ù€Ø¨Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ùˆ ÙƒÙ€Ù€Ù…Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø§Ù„</h1>
      <p>ØªÙ€Ø¬Ù€Ù€Ø§Ø±Ø© Ø¨Ø§Ù„Ø¬Ù€Ù…Ù€Ù„Ø© Ù„Ù„Ù…Ù€Ù†ØªØ¬Ù€Ù€Ø§Øª Ø§Ù„Ù…Ù€Ø±ØªÙ€Ù€Ø¨Ø·Ù€Ø© Ø¨ØªÙ€ØºÙ€Ø°ÙŠØ© Ø§Ù„Ø¥Ù†Ù€Ø³Ù€Ù€Ù€Ù€Ù€Ø§Ù†</p>
      <p>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø§Ù„Ø·Ø§Ø±ÙØ© Ù…Ø­Ù„ Ø±Ù‚Ù… 01 Ø¨Ù†ÙŠ ÙˆØ§Ù„Ø¨Ø§Ù†</p>
      <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¨Ø§Ø¦ÙŠ: 184210105292140 | Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ: 198421010529240</p>
      <p>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: 12Ø£0758272-02/21 | Ø±Ù‚Ù… Ø§Ù„Ù…Ø§Ø¯Ø©: 21210460081</p>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
      <div class="section-box">
        <p>ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… : <span id="invoice-number"></span></p>
        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="invoice-date"></span></p>
      </div>

      <div class="section-box">
        <select id="client-select" onchange="fillClientInfo()" class="border rounded p-1 text-sm w-full mb-2 no-print">
          <option value="">-- Ø§Ø®ØªØ± Ø²Ø¨ÙˆÙ†Ø§Ù‹ --</option>
        </select>
        <p><strong id="client-name">Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†</strong></p>
        <p>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: <span id="client-address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‡Ù†Ø§</span></p>
        <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¨Ø§Ø¦ÙŠ: <span id="client-nif">000000000000000</span></p>
      </div>
    </div>

    <div class="section-box2">
      <table>
        <thead>
          <tr>
            <th class="no-print">Ø­Ø°Ù</th>
            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          </tr>
        </thead>
        <tbody id="invoice-items"></tbody>
      </table>

      <div class="no-print mt-3">
        <button onclick="addRow()" class="bg-emerald-600 text-white px-4 py-2 rounded">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
      </div>
    </div>

    <div class="totals-box">
      <table class="totals-table">
        <tr>
          <td class="amount" id="sub-total-val">0,00</td>
          <td class="label">Ø§Ù„Ù…Ù€Ø¬Ù…Ù€ÙˆØ¹ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø±Ø³Ù…</td>
        </tr>
        <tr>
          <td class="amount" id="tva-val">0,00</td>
          <td class="label">Ø§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©</td>
        </tr>
        <tr>
          <td class="amount">0,00</td>
          <td class="label">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹</td>
        </tr>
        <tr class="total">
          <td class="amount" id="grand-total-val">0,00</td>
          <td class="label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¨ÙƒÙ„ Ø§Ù„Ø±Ø³ÙˆÙ…</td>
        </tr>
      </table>
    </div>

    <div class="amount-words">
      <strong>Ø£ÙˆÙ‚ÙØª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº:</strong> <span id="amount-words-text">ØµÙØ± Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ</span>
    </div>

    <div class="amount-words-text">
      <strong>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ³Ø¯ÙŠØ¯ :</strong> Ø´ÙŠÙƒ Ø¨Ù†ÙƒÙŠ
    </div>

    <div class="signature">
      <div class="sig-box">
        <div>Ø§Ù„Ø®ØªÙ€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù… ÙˆØ§Ù„Ø§Ù…Ø¶Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø§Ø¡</div>
      </div>
    </div>

    <div class="no-print flex justify-between mt-8">
      <div class="flex gap-2">
        <button onclick="addRow()" class="bg-teal-600 text-white px-4 py-2 rounded">â• Ù…Ù†ØªØ¬</button>
        <button onclick="window.location.reload()" class="bg-gray-600 text-white px-4 py-2 rounded">ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button onclick="savePDF()" class="bg-blue-600 text-white px-4 py-2 rounded">ğŸ“¥ Ø­ÙØ¸ PDF</button>
      </div>
      <button onclick="window.print()" class="bg-red-600 text-white px-4 py-2 rounded">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>
  </div>


  <!-- html2pdf library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
const db = {
  clients: [
    { id: 1, company_name: "Ø´ Ø° Ù… Ù… ØºØ±Ø§Ø¨ ÙÙˆÙˆØ¯ Ø­ÙˆØ§Ø³", english_name: "SARL GHORAB FOOD HAOUAS", address: "Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø§ÙŠØ¯Ø§Ø¹ Ø¹ÙŠÙ† Ù…Ù„ÙŠÙ„Ø©", nif: "002304040656913" },
    { id: 2, company_name: "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø£Ù…Ù„ Ù„Ù„ØªÙˆØ²ÙŠØ¹", english_name: "EURL EL AMAL DISTRIBUTION", address: "Ø­ÙŠ Ø§Ù„Ø¥Ø®ÙˆØ© Ø¨Ù† Ø´Ø§Ø¹Ø©ØŒ Ø¹Ù†Ø§Ø¨Ø©", nif: "001204040556812" }
  ],
  products: [
    { id: 1, name: "Ø²ÙŠØª Ø§Ù„ÙŠÙˆ 1 Ù„ØªØ±", unit: "Ù‚Ø§Ø±ÙˆØ±Ø©", price: 118.00 },
    { id: 2, name: "Ø²ÙŠØª Ø§Ù„ÙŠÙˆ 2 Ù„ØªØ±", unit: "Ù‚Ø§Ø±ÙˆØ±Ø©", price: 229.00 },
    { id: 3, name: "Ø²ÙŠØª Ø§Ù„ÙŠÙˆ 5 Ù„ØªØ±", unit: "Ù‚Ø§Ø±ÙˆØ±Ø©", price: 585.00 },
    { id: 4, name: "Ø³ÙƒØ± Ø£Ø¨ÙŠØ¶ 1 ÙƒØº", unit: "ÙƒÙ„Øº", price: 84.00 },
    { id: 5, name: "Ø³ÙƒØ± Ø£Ø¨ÙŠØ¶ 2 ÙƒØº", unit: "ÙƒÙ„Øº", price: 168.00 },
    { id: 6, name: "Ø³ÙƒØ± Ø£Ø¨ÙŠØ¶ 5 ÙƒØº", unit: "ÙƒÙ„Øº", price: 420.00 }
  ]
};

// ğŸ§© Fill the clients dropdown
function populateClientSelect() {
  const select = document.getElementById("client-select");
  db.clients.forEach(c => {
    const opt = document.createElement("option");
    opt.value = c.id;
    opt.textContent = c.company_name;
    select.appendChild(opt);
  });
}

// ğŸ§© When selecting a client, fill info
function fillClientInfo() {
  const id = document.getElementById("client-select").value;
  const c = db.clients.find(x => x.id == id);
  if (!c) return;
  document.getElementById("client-name").textContent = `${c.company_name} (${c.english_name})`;
  document.getElementById("client-address").textContent = c.address;
  document.getElementById("client-nif").textContent = c.nif;
}

// ğŸ§© Add a product row
function addRow() {
  const tb = document.getElementById("invoice-items");
  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td class="no-print">
      <button onclick="this.closest('tr').remove(); calculateTotals();" class="bg-red-600 text-white px-2 py-1 rounded text-xs">âœ–</button>
    </td>
    <td>
      <select class="border rounded p-1 text-sm w-full no-print" onchange="selectProduct(this)">
        <option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ø§Ù‹ --</option>
        ${db.products.map(p => `<option value="${p.id}">${p.name}</option>`).join('')}
      </select>
      <span class="product-name"></span>
    </td>
    <td class="product-unit">-</td>
    <td contenteditable="true" data-type="qty" oninput="calculateRow(this)">1</td>
    <td contenteditable="true" data-type="price" oninput="calculateRow(this)">0</td>
    <td class="item-total font-bold text-left">0 Ø¯.Ø¬</td>
  `;
  tb.appendChild(tr);
}

// ğŸ§© When selecting a product
function selectProduct(select) {
  const row = select.closest("tr");
  const p = db.products.find(x => x.id == select.value);
  const span = row.querySelector(".product-name");
  const unitCell = row.querySelector(".product-unit");
  const priceCell = row.querySelector('[data-type="price"]');
  if (!p) {
    span.textContent = "";
    unitCell.textContent = "-";
    priceCell.textContent = "0";
    calculateRow(priceCell);
    return;
  }
  span.textContent = p.name;
  unitCell.textContent = p.unit;
  priceCell.textContent = p.price.toFixed(2);
  calculateRow(priceCell);
}

// ğŸ§® Helpers
function cleanNumber(v) { return parseFloat((v+'').replace(/[^0-9.]/g, '')) || 0; }
function formatCurrency(a) { return a.toLocaleString('fr-DZ',{minimumFractionDigits:2}); }

function calculateRow(el) {
  const r = el.closest("tr");
  const q = cleanNumber(r.querySelector('[data-type="qty"]').textContent);
  const p = cleanNumber(r.querySelector('[data-type="price"]').textContent);
  r.querySelector(".item-total").textContent = formatCurrency(q * p) + " Ø¯.Ø¬";
  calculateTotals();
}

function numberToArabicWords(num) {
  if (num === 0) return "ØµÙØ± Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ";
  const ones = ["", "ÙˆØ§Ø­Ø¯", "Ø§Ø«Ù†Ø§Ù†", "Ø«Ù„Ø§Ø«Ø©", "Ø£Ø±Ø¨Ø¹Ø©", "Ø®Ù…Ø³Ø©", "Ø³ØªØ©", "Ø³Ø¨Ø¹Ø©", "Ø«Ù…Ø§Ù†ÙŠØ©", "ØªØ³Ø¹Ø©"];
  const teens = ["Ø¹Ø´Ø±Ø©", "Ø£Ø­Ø¯ Ø¹Ø´Ø±", "Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±", "Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±", "Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±", "Ø®Ù…Ø³Ø© Ø¹Ø´Ø±", "Ø³ØªØ© Ø¹Ø´Ø±", "Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±", "Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±", "ØªØ³Ø¹Ø© Ø¹Ø´Ø±"];
  const tens = ["", "", "Ø¹Ø´Ø±ÙˆÙ†", "Ø«Ù„Ø§Ø«ÙˆÙ†", "Ø£Ø±Ø¨Ø¹ÙˆÙ†", "Ø®Ù…Ø³ÙˆÙ†", "Ø³ØªÙˆÙ†", "Ø³Ø¨Ø¹ÙˆÙ†", "Ø«Ù…Ø§Ù†ÙˆÙ†", "ØªØ³Ø¹ÙˆÙ†"];
  const hundreds = ["", "Ù…Ø§Ø¦Ø©", "Ù…Ø§Ø¦ØªØ§Ù†", "Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©", "Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©", "Ø®Ù…Ø³Ù…Ø§Ø¦Ø©", "Ø³ØªÙ…Ø§Ø¦Ø©", "Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©", "Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©", "ØªØ³Ø¹Ù…Ø§Ø¦Ø©"];
  function under100(n) {
    if (n < 10) return ones[n];
    if (n < 20) return teens[n - 10];
    const t = Math.floor(n / 10);
    const o = n % 10;
    return o ? `${ones[o]} Ùˆ ${tens[t]}` : tens[t];
  }
  function under1000(n) {
    if (n === 0) return "";
    const h = Math.floor(n / 100);
    const r = n % 100;
    let parts = [];
    if (h > 0) parts.push(hundreds[h]);
    if (r > 0) parts.push(under100(r));
    return parts.join(" Ùˆ ");
  }
  const millions = Math.floor(num / 1_000_000);
  const thousands = Math.floor((num % 1_000_000) / 1000);
  const rest = num % 1000;
  let words = "";
  if (millions > 0) {
    if (millions === 1) words = "Ù…Ù„ÙŠÙˆÙ†";
    else if (millions === 2) words = "Ù…Ù„ÙŠÙˆÙ†Ø§Ù†";
    else if (millions >= 3 && millions <= 10) words = under1000(millions) + " Ù…Ù„Ø§ÙŠÙŠÙ†";
    else words = under1000(millions) + " Ù…Ù„ÙŠÙˆÙ†";
  }
  if (thousands > 0) {
    if (thousands === 1) words += (words ? " Ùˆ " : "") + "Ø£Ù„Ù";
    else if (thousands === 2) words += (words ? " Ùˆ " : "") + "Ø£Ù„ÙØ§Ù†";
    else if (thousands >= 3 && thousands <= 10) words += (words ? " Ùˆ " : "") + under1000(thousands) + " Ø¢Ù„Ø§Ù";
    else words += (words ? " Ùˆ " : "") + under1000(thousands) + " Ø£Ù„Ù";
  }
  if (rest > 0) words += (words ? " Ùˆ " : "") + under1000(rest);
  return words + " Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ";
}

function calculateTotals() {
  let subtotal = 0;
  document.querySelectorAll(".item-total").forEach(td => subtotal += cleanNumber(td.textContent));
  const tva = subtotal * 0.0;
  const total = subtotal + tva;
  document.getElementById("sub-total-val").textContent = formatCurrency(subtotal);
  document.getElementById("tva-val").textContent = formatCurrency(tva);
  document.getElementById("grand-total-val").textContent = formatCurrency(total);
  document.getElementById("amount-words-text").textContent = numberToArabicWords(Math.round(total));
}

function generateInvoiceInfo() {
  const num = Math.floor(Math.random() * 9000 + 1000);
  document.getElementById("invoice-number").textContent = num + "/" + new Date().getFullYear();
  document.getElementById("invoice-date").textContent = new Date().toLocaleDateString('ar-DZ');
}

// ğŸ§¾ Save PDF
function savePDF() {
  const invoiceNumber = document.getElementById("invoice-number").textContent || "0000";
  const element = document.querySelector(".invoice-page");

  const opt = {
    margin: 0.5,
    filename: `ÙØ§ØªÙˆØ±Ø©_${invoiceNumber}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().from(element).set(opt).save();
}

// âœ… Initialize everything on page load
window.addEventListener("DOMContentLoaded", () => {
  populateClientSelect();
  generateInvoiceInfo();
  addRow(); // start with one row by default
});
</script>
</body>
</html>   
